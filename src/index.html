<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Puter FAQ Center</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      --font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;

      /* Light Theme */
      --bg-primary-light: #ffffff;
      --bg-secondary-light: #f8f9fa;
      --bg-tertiary-light: #e9ecef;
      --text-primary-light: #212529;
      --text-secondary-light: #495057;
      --accent-light: #007bff;
      --accent-hover-light: #0056b3;
      --border-light: #dee2e6;
      --shadow-light: 0 3px 10px rgba(0, 0, 0, 0.07);
      --resizer-light: #d1d5db;

      /* Dark Theme */
      --bg-primary-dark: #20232a;
      --bg-secondary-dark: #1a1c22;
      --bg-tertiary-dark: #30353f;
      --text-primary-dark: #e1e1e1;
      --text-secondary-dark: #adb5bd;
      --accent-dark: #61dafb;
      --accent-hover-dark: #21a1f2;
      --border-dark: #3a4048;
      --shadow-dark: 0 3px 10px rgba(0, 0, 0, 0.2);
      --resizer-dark: #4b5563;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: var(--font-sans);
      display: flex;
      height: 100vh;
      overflow: hidden;
      background-color: var(--bg-secondary-light);
      color: var(--text-primary-light);
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    body.dark-mode {
      background-color: var(--bg-secondary-dark);
      color: var(--text-primary-dark);
    }

    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    body.dark-mode ::-webkit-scrollbar-thumb { background: #4a5058; border-radius: 4px; }
    body:not(.dark-mode) ::-webkit-scrollbar-thumb { background: #c1c7d0; border-radius: 4px; }
    body.dark-mode ::-webkit-scrollbar-thumb:hover { background: var(--accent-dark); }
    body:not(.dark-mode) ::-webkit-scrollbar-thumb:hover { background: var(--accent-light); }

    #sidebar {
      width: 30%;
      min-width: 400px;
      max-width: 60%;
      background-color: var(--bg-primary-light);
      padding: 20px;
      display: flex;
      flex-direction: column;
      height: 100vh;
      position: relative;
      transition: background-color 0.3s ease;
      flex-shrink: 0;
    }
    body.dark-mode #sidebar {
      background-color: var(--bg-primary-dark);
    }

    #sidebar-resizer {
        width: 8px;
        height: 100%;
        position: absolute;
        right: -4px;
        top: 0;
        cursor: col-resize;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    #sidebar-resizer::before {
        content: '';
        width: 1px;
        height: 95%;
        background-color: var(--resizer-light);
        transition: background-color 0.3s ease;
    }
    body.dark-mode #sidebar-resizer::before {
        background-color: var(--resizer-dark);
    }

    .sidebar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-light);
    }
    body.dark-mode .sidebar-header { border-bottom-color: var(--border-dark); }
    #sidebar h3 { margin: 0; font-size: 1.3em; color: var(--text-primary-light); font-weight: 600;}
    body.dark-mode #sidebar h3 { color: var(--text-primary-dark); }
    #theme-toggle {
        background: none; border: none; color: var(--text-secondary-light);
        font-size: 1.2em; cursor: pointer; padding: 8px; border-radius: 50%;
        transition: color 0.2s, background-color 0.2s;
    }
    body.dark-mode #theme-toggle { color: var(--text-secondary-dark); }
    #theme-toggle:hover { background-color: var(--bg-tertiary-light); color: var(--accent-light); }
    body.dark-mode #theme-toggle:hover { background-color: var(--bg-tertiary-dark); color: var(--accent-dark); }

    #search-bar {
        width: 100%;
        padding: 10px 12px;
        margin-bottom: 15px;
        border: 1px solid var(--border-light);
        border-radius: 6px;
        font-size: 0.95em;
        background-color: var(--bg-primary-light);
        color: var(--text-primary-light);
    }
    body.dark-mode #search-bar {
        background-color: var(--bg-primary-dark);
        color: var(--text-primary-dark);
        border-color: var(--border-dark);
    }
    #search-bar::placeholder { color: var(--text-secondary-light); }
    body.dark-mode #search-bar::placeholder { color: var(--text-secondary-dark); }

    #question-list-container {
        flex-grow: 1;
        overflow-y: auto;
    }

    .question-link {
      display: block;
      margin-bottom: 6px;
      padding: 12px 18px;
      border-radius: 6px;
      color: var(--text-secondary-light);
      text-decoration: none;
      font-weight: 500;
      transition: background-color 0.2s ease, color 0.2s ease, transform 0.1s ease;
      word-break: break-word;
      cursor: pointer;
      font-size: 0.95em;
    }
    body.dark-mode .question-link { color: var(--text-secondary-dark); }
    .question-link:hover { background-color: var(--bg-tertiary-light); color: var(--accent-light); transform: translateX(2px); }
    body.dark-mode .question-link:hover { background-color: var(--bg-tertiary-dark); color: var(--accent-dark); }
    .question-link.active { background-color: var(--accent-light); color: white !important; font-weight: 600; }
    body.dark-mode .question-link.active { background-color: var(--accent-dark); color: var(--bg-primary-dark) !important; }
    .question-link.hidden-by-search { display: none; }

    #content-area {
      flex-grow: 1;
      flex-shrink: 1;
      min-width: 300px;
      height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border-left: 1px solid var(--resizer-light);
    }
    body.dark-mode #content-area {
        border-left-color: var(--resizer-dark);
    }

    #answer-content-wrapper {
      background-color: var(--bg-primary-light);
      border-radius: 10px;
      box-shadow: var(--shadow-light);
      width: 100%;
      flex-grow: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    body.dark-mode #answer-content-wrapper {
      background-color: var(--bg-primary-dark);
      box-shadow: var(--shadow-dark);
    }

    #answer-content-wrapper iframe {
        width: 100%;
        height: 100%;
        border: none;
        flex-grow: 1;
    }

    #status-messages { color: var(--text-secondary-light); margin-bottom: 10px; font-style: italic; font-size: 0.9em; }
    body.dark-mode #status-messages { color: var(--text-secondary-dark); }

    .loading-message, .status-message { text-align: center; padding: 20px; color: var(--text-secondary-light); font-style: italic; }
    body.dark-mode .loading-message, body.dark-mode .status-message { color: var(--text-secondary-dark); }

    #scroll-to-top {
        position: fixed; bottom: 25px; right: calc(25px + 20px); /* Adjusted for padding */
        background-color: var(--accent-light);
        color: white; border: none; border-radius: 50%; width: 45px; height: 45px;
        font-size: 1.3em; display: none; align-items: center; justify-content: center;
        cursor: pointer; box-shadow: var(--shadow-light);
        transition: background-color 0.2s, opacity 0.3s, transform 0.3s;
        z-index: 1000;
    }
    body.dark-mode #scroll-to-top { background-color: var(--accent-dark); color: var(--bg-primary-dark); box-shadow: var(--shadow-dark); }
    #scroll-to-top:hover { transform: scale(1.1); }
    #scroll-to-top.visible { display: flex; }

  </style>
</head>
<body>
  <div id="sidebar">
    <div id="sidebar-resizer"></div>
    <div class="sidebar-header">
        <h3><i class="fas fa-question-circle" style="margin-right: 8px;"></i>FAQ Center</h3>
        <button id="theme-toggle" title="Toggle theme">
            <i class="fas fa-sun"></i>
        </button>
    </div>
    <input type="text" id="search-bar" placeholder="Search questions...">
    <div id="status-messages">Loading questions...</div>
    <div id="question-list-container">
        <div id="question-list"></div>
    </div>
  </div>

  <div id="content-area">
    <div id="answer-content-wrapper">
        <div class="loading-message">Select a question to see the answer.</div>
    </div>
  </div>

  <button id="scroll-to-top" title="Scroll to top"><i class="fas fa-arrow-up"></i></button>

  <script>
    const questionListEl = document.getElementById('question-list');
    const answerContentWrapperEl = document.getElementById('answer-content-wrapper');
    const statusMessagesEl = document.getElementById('status-messages');
    const themeToggleButton = document.getElementById('theme-toggle');
    const themeIcon = themeToggleButton.querySelector('i');
    const scrollToTopButton = document.getElementById('scroll-to-top');
    const searchBar = document.getElementById('search-bar');
    const sidebar = document.getElementById('sidebar');
    const sidebarResizer = document.getElementById('sidebar-resizer');
    const contentArea = document.getElementById('content-area');

    let activeLink = null;
    let currentIframe = null; // Keep track of the current iframe
    let isResizing = false;

    const answersSubFolderName = "answers";
    const MAX_ANSWER_FILES_TO_CHECK = 30;
    const initialPageTitle = "Puter FAQ Center";

    // Function to synchronize iframe theme with the main page
    function syncIframeTheme(iframeInstance) {
        if (iframeInstance && iframeInstance.contentWindow && iframeInstance.contentDocument) {
            try {
                const iframeHtmlElement = iframeInstance.contentDocument.documentElement;
                if (document.body.classList.contains('dark-mode')) {
                    iframeHtmlElement.classList.add('dark-mode');
                } else {
                    iframeHtmlElement.classList.remove('dark-mode');
                }
            } catch (e) {
                // This can happen if the iframe is not fully loaded or if it's a cross-origin iframe (not the case here)
                console.warn("Could not sync theme to iframe. It might be loading or from a different origin (unlikely for local files).", e);
            }
        }
    }

    async function extractQuestionFromHTML(htmlContent) {
        const metaCommentMatch = htmlContent.match(/<!--\s*q:\s*(.+?)\s*-->/i);
        if (metaCommentMatch && metaCommentMatch[1]) {
            return metaCommentMatch[1].trim();
        }
        // Fallback to H1 if meta comment not found
        try {
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlContent, "text/html");
            const h1 = doc.querySelector('h1');
            if (h1 && h1.textContent) {
                return h1.textContent.trim();
            }
        } catch (e) {
            console.warn("Could not parse HTML for H1 fallback:", e);
        }
        return null; // Return null if no question found
      }

    async function loadAndDisplayQuestions() {
      statusMessagesEl.textContent = `Scanning for answers in /${answersSubFolderName}/...`;
      questionListEl.innerHTML = '';
      let discoveredAnswers = [];

      for (let i = 1; i <= MAX_ANSWER_FILES_TO_CHECK; i++) {
        const fileName = `${i}.html`;
        const fileURL = `${answersSubFolderName}/${fileName}`;
        try {
          const response = await fetch(fileURL);
          if (response.ok) {
            const rawContent = await response.text();
            const questionText = await extractQuestionFromHTML(rawContent);
            const displayName = questionText || `Answer ${i}`; // Use Answer i if no specific question text
            discoveredAnswers.push({ id: i, fileName, fileURL, displayName });
          } else {
            if (response.status === 404) {
                // console.log(`File ${fileURL} not found, stopping scan.`);
                break; // Stop scanning if a file in the sequence is not found
            }
            console.warn(`Failed to fetch ${fileURL}: ${response.status}`);
          }
        } catch (error) {
            console.error(`Error fetching ${fileURL}:`, error);
            break; // Stop on network or other errors
        }
      }

      if (discoveredAnswers.length === 0) {
        statusMessagesEl.textContent = ''; // Clear "Scanning..." message
        const errorMsg = `No numbered .html answer files found in '/${answersSubFolderName}/'. Make sure files are named 1.html, 2.html, etc.`;
        questionListEl.innerHTML = `<p class="status-message">${errorMsg}</p>`;
        answerContentWrapperEl.innerHTML = `<div class="loading-message">${errorMsg}</div>`;
        document.title = initialPageTitle;
        return;
      }

      statusMessagesEl.textContent = ''; // Clear "Scanning..." message
      discoveredAnswers.forEach(answer => {
        const link = document.createElement('div');
        link.className = 'question-link';
        link.textContent = answer.displayName;
        link.setAttribute('data-fileurl', answer.fileURL);
        link.setAttribute('data-question-text', answer.displayName.toLowerCase());
        link.onclick = () => {
          if (activeLink) activeLink.classList.remove('active');
          link.classList.add('active');
          activeLink = link;
          document.title = `${answer.displayName} | ${initialPageTitle}`;
          answerContentWrapperEl.innerHTML = '<div class="loading-message">Loading answer...</div>';

          if (currentIframe) currentIframe.remove(); // Remove old iframe if exists

          currentIframe = document.createElement('iframe');
          currentIframe.onload = () => { // Sync theme AFTER iframe has loaded
            syncIframeTheme(currentIframe);
          };
          currentIframe.src = answer.fileURL; // Set src to trigger load

          answerContentWrapperEl.innerHTML = ''; // Clear loading message
          answerContentWrapperEl.appendChild(currentIframe);
        };
        questionListEl.appendChild(link);
      });

      if (questionListEl.firstChild) {
        answerContentWrapperEl.innerHTML = `<div class="loading-message">Welcome! Select a question from the left to view its answer.</div>`;
      } else {
         // This case should ideally not be reached if discoveredAnswers.length > 0
        answerContentWrapperEl.innerHTML = '<div class="loading-message">Select a question.</div>';
        document.title = initialPageTitle;
      }
    }

    searchBar.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase().trim();
        const links = questionListEl.querySelectorAll('.question-link');
        let visibleCount = 0;
        links.forEach(link => {
            const questionText = link.getAttribute('data-question-text');
            if (questionText.includes(searchTerm)) {
                link.classList.remove('hidden-by-search');
                visibleCount++;
            } else {
                link.classList.add('hidden-by-search');
            }
        });
        const noResultsEl = questionListEl.querySelector('.no-results');
        if (visibleCount === 0 && searchTerm !== '') {
             if (!noResultsEl) {
                const noResultsMsg = document.createElement('p');
                noResultsMsg.className = 'status-message no-results';
                noResultsMsg.textContent = 'No questions match your search.';
                questionListEl.appendChild(noResultsMsg);
             }
        } else {
            if (noResultsEl) noResultsEl.remove();
        }
    });

    function applyTheme(theme) {
        if (theme === 'dark') {
            document.body.classList.add('dark-mode');
            themeIcon.classList.remove('fa-sun');
            themeIcon.classList.add('fa-moon');
        } else {
            document.body.classList.remove('dark-mode');
            themeIcon.classList.remove('fa-moon');
            themeIcon.classList.add('fa-sun');
        }
        localStorage.setItem('faq_theme', theme);

        // Sync current iframe's theme if it exists
        if (currentIframe) {
            syncIframeTheme(currentIframe);
        }
    }
    themeToggleButton.addEventListener('click', () => {
        applyTheme(document.body.classList.contains('dark-mode') ? 'light' : 'dark');
    });
    const savedTheme = localStorage.getItem('faq_theme');
    const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (savedTheme) {
        applyTheme(savedTheme);
    } else {
        applyTheme(systemPrefersDark ? 'dark' : 'light');
    }
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
        if (!localStorage.getItem('faq_theme')) { // Only apply if no explicit user choice
            applyTheme(e.matches ? 'dark' : 'light');
        }
    });

    const scrollableSidebar = document.getElementById('question-list-container');
    scrollableSidebar.addEventListener('scroll', () => {
        scrollToTopButton.classList.toggle('visible', scrollableSidebar.scrollTop > 150);
    });
    scrollToTopButton.addEventListener('click', () => {
        scrollableSidebar.scrollTo({ top: 0, behavior: 'smooth' });
    });

    let initialSidebarWidth = 0;
    let initialMouseX = 0;

    sidebarResizer.addEventListener('mousedown', function(e) {
        e.preventDefault();
        isResizing = true;
        initialMouseX = e.clientX;
        initialSidebarWidth = sidebar.offsetWidth;
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none'; // Prevent text selection during resize
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', handleMouseUp);
    });

    function handleMouseMove(e) {
        if (!isResizing) return;
        const dx = e.clientX - initialMouseX;
        let newWidth = initialSidebarWidth + dx;

        const minWidth = parseInt(getComputedStyle(sidebar).minWidth, 10) || 150; // Fallback minWidth
        const contentAreaMinTheoreticalWidth = parseInt(getComputedStyle(contentArea).minWidth, 10) || 200; // Fallback
        const resizerAndPadding = sidebarResizer.offsetWidth + (parseInt(getComputedStyle(sidebar).paddingLeft, 10) || 0) + (parseInt(getComputedStyle(sidebar).paddingRight, 10) || 0) + (parseInt(getComputedStyle(contentArea).paddingLeft, 10) || 0) + (parseInt(getComputedStyle(contentArea).paddingRight, 10) || 0) ;
        const viewportWidth = window.innerWidth;
        let calculatedMaxWidthForSidebar = viewportWidth - contentAreaMinTheoreticalWidth - resizerAndPadding;

        const cssMaxWidthValue = getComputedStyle(sidebar).maxWidth;
        let cssMaxWidthPixels = viewportWidth; // Default to full viewport if not specified or in percent
        if (cssMaxWidthValue && cssMaxWidthValue !== 'none') {
            if (cssMaxWidthValue.endsWith('px')) {
                cssMaxWidthPixels = parseInt(cssMaxWidthValue, 10);
            } else if (cssMaxWidthValue.endsWith('%')) {
                cssMaxWidthPixels = viewportWidth * (parseFloat(cssMaxWidthValue) / 100);
            }
        }

        const finalMaxWidth = Math.min(calculatedMaxWidthForSidebar, cssMaxWidthPixels);
        newWidth = Math.max(minWidth, Math.min(newWidth, finalMaxWidth));
        sidebar.style.width = `${newWidth}px`;
    }

    function handleMouseUp() {
        if (!isResizing) return;
        isResizing = false;
        document.removeEventListener('mousemove', handleMouseMove);
        document.removeEventListener('mouseup', handleMouseUp);
        document.body.style.cursor = 'default';
        document.body.style.userSelect = 'auto'; // Re-enable text selection
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadAndDisplayQuestions();
    });
  </script>
</body>
</html>